!function(a,b){"use strict";"function"==typeof define&&define.amd?define([],b):"object"==typeof exports?module.exports=b():a.viewportUnitsBuggyfill=b()}(this,function(){"use strict";function o(a,b){var c;return function(){var d=this,e=arguments,f=function(){a.apply(d,e)};clearTimeout(c),c=setTimeout(f,b)}}function p(){try{return window.self!==window.top}catch(a){return!0}}function q(c){if(!a){if(c===!0&&(c={force:!0}),b=c||{},b.isMobileSafari=l,b.isBadStockAndroid=m,!b.ignoreVmax||b.force||j||(i=!1),j||!b.force&&!l&&!i&&!m&&!k&&(!b.hacks||!b.hacks.required(b)))return window.console&&j&&console.info("viewport-units-buggyfill requires a proper CSSOM and basic viewport unit support, which are not available in IE8 and below"),{init:function(){}};window.dispatchEvent(new n("viewport-units-buggyfill-init")),b.hacks&&b.hacks.initialize(b),a=!0,h=document.createElement("style"),h.id="patched-viewport",document.head.appendChild(h),A(function(){var a=o(s,b.refreshDebounceWait||100);window.addEventListener("orientationchange",a,!0),window.addEventListener("pageshow",a,!0),(b.force||i||p())&&(window.addEventListener("resize",a,!0),b._listeningToResize=!0),b.hacks&&b.hacks.initializeEvents(b,s,a),s()})}}function r(){h.textContent=w(),h.parentNode.appendChild(h),window.dispatchEvent(new n("viewport-units-buggyfill-style"))}function s(){a&&(u(),setTimeout(function(){r()},1))}function t(a){try{if(!a.cssRules)return}catch(a){if("SecurityError"!==a.name)throw a;return}for(var b=[],c=0;c<a.cssRules.length;c++){var d=a.cssRules[c];b.push(d)}return b}function u(){return g=[],e.call(document.styleSheets,function(a){var b=t(a);b&&"patched-viewport"!==a.ownerNode.id&&"ignore"!==a.ownerNode.getAttribute("data-viewport-units-buggyfill")&&(a.media&&a.media.mediaText&&window.matchMedia&&!window.matchMedia(a.media.mediaText).matches||e.call(b,v))}),g}function v(a){if(7===a.type){var c;try{c=a.cssText}catch(a){return}return d.lastIndex=0,void(d.test(c)&&(g.push([a,null,c]),b.hacks&&b.hacks.findDeclarations(g,a,null,c)))}if(!a.style){if(!a.cssRules)return;return void e.call(a.cssRules,function(a){v(a)})}e.call(a.style,function(c){var e=a.style.getPropertyValue(c);a.style.getPropertyPriority(c)&&(e+=" !important"),d.lastIndex=0,d.test(e)&&(g.push([a,c,e]),b.hacks&&b.hacks.findDeclarations(g,a,c,e))})}function w(){f=z();var c,d,a=[],b=[];return g.forEach(function(e){var f=x.apply(null,e),g=f.selector.length?f.selector.join(" {\n")+" {\n":"",h=new Array(f.selector.length+1).join("\n}");return g&&g===c?(g&&!c&&(c=g,d=h),void b.push(f.content)):(b.length&&(a.push(c+b.join("\n")+d),b.length=0),void(g?(c=g,d=h,b.push(f.content)):(a.push(f.content),c=null,d=null)))}),b.length&&a.push(c+b.join("\n")+d),k&&a.push("* { content: normal !important; }"),a.join("\n\n")}function x(a,c,e){var f,g=[];f=e.replace(d,y),b.hacks&&(f=b.hacks.overwriteDeclaration(a,c,f)),c&&(g.push(a.selectorText),f=c+": "+f+";");for(var h=a.parentRule;h;)h.media?g.unshift("@media "+h.media.mediaText):h.conditionText&&g.unshift("@supports "+h.conditionText),h=h.parentRule;return{selector:g,content:f}}function y(a,b,c){var d=f[c],e=parseFloat(b)/100;return e*d+"px"}function z(){var a=window.innerHeight,b=window.innerWidth;return{vh:a,vw:b,vmax:Math.max(b,a),vmin:Math.min(b,a)}}function A(a){var b=0,c=function(){b--,b||a()};e.call(document.styleSheets,function(a){a.href&&B(a.href)!==B(location.href)&&"ignore"!==a.ownerNode.getAttribute("data-viewport-units-buggyfill")&&(b++,C(a.ownerNode,c))}),b||a()}function B(a){return a.slice(0,a.indexOf("/",a.indexOf("://")+3))}function C(a,b){D(a.href,function(){var c=document.createElement("style");c.media=a.media,c.setAttribute("data-href",a.href),c.textContent=this.responseText,a.parentNode.replaceChild(c,a),b()},b)}function D(a,b,c){var d=new XMLHttpRequest;if("withCredentials"in d)d.open("GET",a,!0);else{if("undefined"==typeof XDomainRequest)throw new Error("cross-domain XHR not supported");d=new XDomainRequest,d.open("GET",a)}return d.onload=b,d.onerror=c,d.send(),d}var b,f,g,h,a=!1,c=window.navigator.userAgent,d=/([+-]?[0-9.]+)(vh|vw|vmin|vmax)/g,e=[].forEach,i=/MSIE [0-9]\./i.test(c),j=/MSIE [0-8]\./i.test(c),k=c.indexOf("Opera Mini")>-1,l=/(iPhone|iPod|iPad).+AppleWebKit/i.test(c)&&function(){var a=c.match(/OS (\d)/);return a&&a.length>1&&parseInt(a[1])<10}(),m=function(){var a=c.indexOf(" Android ")>-1;if(!a)return!1;var b=c.indexOf("Version/")>-1;if(!b)return!1;var d=parseFloat((c.match("Android ([0-9.]+)")||[])[1]);return d<=4.4}();i||(i=!!navigator.userAgent.match(/MSIE 10\.|Trident.*rv[ :]*1[01]\.| Edge\/1\d\./));try{new n("test")}catch(a){var n=function(a,b){var c;return b=b||{bubbles:!1,cancelable:!1,detail:void 0},c=document.createEvent("CustomEvent"),c.initCustomEvent(a,b.bubbles,b.cancelable,b.detail),c};n.prototype=window.Event.prototype,window.CustomEvent=n}return{version:"0.6.1",findProperties:u,getCss:w,init:q,refresh:s}});